<!doctype html><html lang=en><head><title>Primary Unit – Solving boredom with four languages</title><meta charset=utf-8><meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; media-src 'self'; block-all-mixed-content; base-uri 'self'"><link rel=license href=https://creativecommons.org/licenses/by/4.0/><link rel=alternate type=application/rss+xml href=/rss.xml title="Primary Unit"><link rel=alternate type=application/json href=/feed.json title="Primary Unit"><link rel=mask-icon href=/favicon.svg color=#1369bf><link rel=apple-touch-icon-precomposed href=/favicon.png><link rel=icon href=/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A blog by Rob Wells, mostly about computer stuff."><style>html,body,div,span,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,address,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strong,sub,sup,var,b,u,i,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,menu,nav,output,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font:inherit;vertical-align:baseline}input,button{font-family:inherit}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section{display:block}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}table{border-collapse:collapse;border-spacing:0}html{box-sizing:border-box;text-size-adjust:100%}*,*:before,*:after{box-sizing:inherit}:root{--grey:#607080;--grey10:#eff0f2;--grey5:#f7f8f9;--blue:#1369bf;--blue10:#e7eff8;--purple:#7436b3;--lineSpace:1.75rem;--halfLine:calc(var(--lineSpace) / 2);--quarterLine:calc(var(--lineSpace) / 4);--bigGap:calc(var(--lineSpace) * 2);--paragraphWidth:40rem;--wrapperWidth:50rem;--huge:1.75rem;--big:1.5625rem;--medium:1.375rem;--text:1.125rem;--small:0.875rem;--codeInText:0.875em;--bodyFonts:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Oxygen", Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Helvetica, sans-serif;--monospace:'Source Code Pro', 'Consolas', 'Menlo', 'Monaco', monospace}body{background-color:var(--grey5);font-family:var(--bodyFonts);font-size:var(--text);font-style:normal;font-weight:400;line-height:1.55555;text-size-adjust:100%;-webkit-text-size-adjust:100%}.wrapper{margin:0 auto;max-width:var(--wrapperWidth);padding:var(--lineSpace)var(--halfLine)}h2,h3,h4{margin:0 0 var(--lineSpace)}h2{font-size:var(--huge)}h3{font-size:var(--big)}h4{font-size:var(--medium)}blockquote,figure,p,pre,table,caption,dl,ol,ul,div.highlight{margin-bottom:var(--lineSpace)}blockquote,pre,div.highlight{background-color:var(--grey10);padding:var(--halfLine)}blockquote{font-style:italic}blockquote em,blockquote i{font-style:normal}blockquote p:last-child{margin-bottom:0}figcaption{font-style:italic}hr{border:none;border-top:1px solid var(--grey);margin:var(--lineSpace)0}img,video{box-sizing:content-box;border:1px solid var(--grey);height:auto;max-width:100%}pre{overflow-x:auto}dl,ol,ul{margin-bottom:var(--lineSpace)}ol,ul{list-style-position:outside;padding-left:var(--lineSpace)}ol{list-style-type:decimal}ul{list-style-type:square}a:link{color:var(--blue);text-decoration:underline}a:visited{color:var(--purple)}a:focus,a:hover,a:active{background-color:var(--blue10)}strong,b{font-weight:700}em,i{font-style:italic}code{font-size:var(--codeInText)}.highlight,pre code,small{font-size:var(--small)}.highlight,code{font-family:var(--monospace)}small{color:var(--grey)}table{width:100%}.table-container{overflow-x:auto}caption{font-style:italic}thead{border-bottom:1px solid var(--grey)}tfoot{border-top:1px solid var(--grey)}th,td{width:auto;padding:var(--halfLine);overflow:auto;text-align:left}th{background-color:var(--grey10);font-weight:700}.table-figures{text-align:right;font-family:var(--monospace)}.site-header{border-left:var(--quarterLine)solid var(--blue);display:flex;flex-wrap:wrap;margin-bottom:var(--lineSpace);padding-left:var(--quarterLine)}.site-title-container{flex-shrink:0;margin-right:var(--lineSpace);max-width:100%}.site-title{font-size:var(--huge);line-height:var(--huge);margin-bottom:0}.site-byline{margin-bottom:0}.site-links{color:var(--grey);list-style-type:none;margin-bottom:0;padding:0}.site-footer{margin-top:var(--bigGap)}article{border-bottom:1px solid var(--grey);margin-bottom:var(--bigGap)}article:last-of-type{border-bottom:none}article header{margin-bottom:var(--lineSpace)}article header h2{margin-bottom:0}article header time{color:var(--grey)}article li{margin-bottom:var(--halfLine)}.index-date{color:var(--grey);font-family:var(--monospace);font-size:var(--small);min-width:6rem;margin-right:var(--halfLine)}.index-item{margin-bottom:var(--halfLine)}.index-link{align-items:baseline;display:flex}.index-list{padding-left:0;list-style-type:none}.flag{background-color:var(--blue10);border-left:var(--quarterLine)solid var(--blue);margin-bottom:var(--lineSpace);padding:var(--halfLine)var(--quarterLine)}.flag :last-child{margin-bottom:0}.full-width{max-width:100%}.mute-links a{text-decoration:none;color:inherit}.no-border{border:0}.no-border img{border:0}.no-squish{overflow:auto}.no-squish img{max-width:none}@media screen and (min-width:40rem){.pull-left{float:left;clear:left;margin-right:var(--halfLine)}.pull-right{float:right;clear:right;margin-left:var(--halfLine)}.pull-left img,.pull-right img{display:block;margin-bottom:var(--lineSpace)}}</style><style>div.highlight>pre.chroma{padding:0;margin:0}:root{--lineNumberGrey:#6D6D6D;--operatorOrange:#B45000;--stringGreen:#357D06}.chroma .x{color:#000}.chroma .err{color:#a40000}.chroma .ln{margin-right:var(--halfLine);padding:0;color:var(--lineNumberGrey)}.chroma .k{color:#204a87;font-weight:700}.chroma .kc{color:#204a87;font-weight:700}.chroma .kd{color:#204a87;font-weight:700}.chroma .kn{color:#204a87;font-weight:700}.chroma .kp{color:#204a87;font-weight:700}.chroma .kr{color:#204a87;font-weight:700}.chroma .kt{color:#204a87;font-weight:700}.chroma .n{color:#000}.chroma .na{color:#c4a000}.chroma .nb{color:#204a87}.chroma .bp{color:#3465a4}.chroma .nc{color:#000}.chroma .no{color:#000}.chroma .nd{color:#5c35cc;font-weight:700}.chroma .ni{color:var(--operatorOrange)}.chroma .ne{color:#c00;font-weight:700}.chroma .nf{color:#000}.chroma .fm{color:#000}.chroma .nl{color:#f57900}.chroma .nn{color:#000}.chroma .nx{color:#000}.chroma .py{color:#000}.chroma .nt{color:#204a87;font-weight:700}.chroma .nv{color:#000}.chroma .vc{color:#000}.chroma .vg{color:#000}.chroma .vi{color:#000}.chroma .vm{color:#000}.chroma .l{color:#000}.chroma .ld{color:#000}.chroma .s{color:var(--stringGreen)}.chroma .sa{color:var(--stringGreen)}.chroma .sb{color:var(--stringGreen)}.chroma .sc{color:var(--stringGreen)}.chroma .dl{color:var(--stringGreen)}.chroma .sd{color:#8f5902;font-style:italic}.chroma .s2{color:var(--stringGreen)}.chroma .se{color:var(--stringGreen)}.chroma .sh{color:var(--stringGreen)}.chroma .si{color:var(--stringGreen)}.chroma .sx{color:var(--stringGreen)}.chroma .sr{color:var(--stringGreen)}.chroma .s1{color:var(--stringGreen)}.chroma .ss{color:var(--stringGreen)}.chroma .m{color:#0000cf;font-weight:700}.chroma .mb{color:#0000cf;font-weight:700}.chroma .mf{color:#0000cf;font-weight:700}.chroma .mh{color:#0000cf;font-weight:700}.chroma .mi{color:#0000cf;font-weight:700}.chroma .il{color:#0000cf;font-weight:700}.chroma .mo{color:#0000cf;font-weight:700}.chroma .o{color:var(--operatorOrange);font-weight:700}.chroma .ow{color:#204a87;font-weight:700}.chroma .p{color:#000;font-weight:700}.chroma .c{color:#8f5902;font-style:italic}.chroma .ch{color:#8f5902;font-style:italic}.chroma .cm{color:#8f5902;font-style:italic}.chroma .c1{color:#8f5902;font-style:italic}.chroma .cs{color:#8f5902;font-style:italic}.chroma .cp{color:#8f5902;font-style:italic}.chroma .cpf{color:#8f5902;font-style:italic}.chroma .g{color:#000}.chroma .gd{color:#a40000}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#ef2929}.chroma .gh{color:navy;font-weight:700}.chroma .gi{color:#00a000}.chroma .go{color:#000;font-style:italic}.chroma .gp{color:#8f5902}.chroma .gs{color:#000;font-weight:700}.chroma .gu{color:purple;font-weight:700}.chroma .gt{color:#a40000;font-weight:700}.chroma .gl{color:#000;text-decoration:underline}.chroma .w{color:#f8f8f8;text-decoration:underline}</style></head><body><div class=wrapper><header class=site-header><div class="site-title-container mute-links"><h1 class=site-title><a href=/>Primary Unit</a></h1><p class=site-byline><i>by</i> Rob Wells</p></div><nav id=site-nav><ul class="site-links mute-links"><li><a href=/about/>About</a></li><li><a href=/books/>Books I’ve read</a></li><li>Feed:
<a href=/feed.json>JSON</a>,
<a href=/rss.xml>RSS</a></li></ul></nav></header><main><article><header><h2 class=mute-links><a href=/2014/12/solving-boredom-with-four-languages/>Solving boredom with four languages</a></h2><p><time datetime=2014-12-04T00:01:00+0000>Thursday, December 4 2014</time></p></header><p>At work one of the most tedious jobs is putting all of the stories that appear in the paper onto our website. We&rsquo;re still working from text files (which works very well) as for a number of reasons we haven&rsquo;t yet changed to use the site&rsquo;s CMS as the central location where copy is stored.</p><p>So towards the end of the day we have to go through nearly all the pages, strip out the headlines, standfirsts and copy, and input them into the site&rsquo;s backend. It&rsquo;s mindless, slow and frankly demoralising.</p><p>A perfect candidate for automation then!</p><p>Let&rsquo;s start with taking the text from the InDesign files, with an AppleScript I run through <a href=http://www.red-sweater.com/fastscripts/>FastScripts</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-applescript data-lang=applescript><span class=line><span class=ln> 1</span><span class=cl><span class=k>tell</span> <span class=nb>application</span> <span class=s2>&#34;Adobe InDesign CS5.5&#34;</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=k>tell</span> <span class=nb>the</span> <span class=nb>front</span> <span class=na>document</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=k>set</span> <span class=nv>the_text</span> <span class=k>to</span> <span class=k>get</span> <span class=nb>the</span> <span class=na>contents</span> <span class=k>of</span> <span class=nb>the</span> <span class=nv>selection</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=k>end</span> <span class=k>tell</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=k>end</span> <span class=k>tell</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=k>repeat</span> <span class=k>with</span> <span class=nv>an_item</span> <span class=k>in</span> <span class=nv>the_text</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=nb>do shell script</span> <span class=p>(</span><span class=s2>&#34;echo &#39;&#34;</span> <span class=o>&amp;</span> <span class=nv>an_item</span> <span class=o>&amp;</span> <span class=s2>&#34;&#39; &gt;&gt; ~/Desktop/web_strip.txt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=k>end</span> <span class=k>repeat</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=nb>do shell script</span> <span class=p>(</span><span class=s2>&#34;echo &#39;\\n\\n\\n\\n&#39; &gt;&gt; ~/Desktop/web_strip.txt&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>Here we take the content of the selected InDesign frames and use a shell script snippet to append it to a file on the desktop, followed by a bunch of newlines to separate the appended text.</p><p>It&rsquo;s straightforward, but <code>the contents of the selection</code> in line 3 could return anything: more than one selected frame and you get a list, just one and you get whatever data is in the frame. So, instead of iterating over several pieces of text in line 7, you iterate over each character in one piece of text. Bonus points: InDesign CS4 (which we use at work) doesn&rsquo;t preserve the order in which you select frames, meaning you have to go one-by-one (and use a different script — I&rsquo;m showing the one I use at home here).</p><p>Ok, now we&rsquo;ve got a text file with all the copy in. Once that&rsquo;s been cleaned up — any unnoticed mistakes corrected, print-focussed formatting removed — it&rsquo;s time to enter it into the CMS.</p><p>For ages, this is where the automation stopped. The editor used in the CMS interprets pasted text oddly, requiring people to paste the plain text into (shock horror) TextEdit in rich-text mode, and from there into the field in the CMS. Lots of copying and pasting. Lots of boredom. Gross.</p><p>But these are just fields on a web page. And, of course, the page uses jQuery. And Safari lets you <code>do JavaScript</code> through AppleScript. This should be trivial. (Chrome also lets you execute JavaScript through AppleScript, but it threw up a weird error that I couldn&rsquo;t be bothered to dig into.)</p><p>A bit of poking around in the inspector revealed that most of the interesting fields could be set through a simple <code>.val(foo)</code> on the element, while the body of the article could be set through <code>.html('bar')</code> — and wrapping paragraphs in <code>&lt;p></code> tags ensured that the text displayed correctly.</p><p>But how to get the text from a file in BBEdit into the fields? We need to use AppleScript to tell Safari to execute JavaScript, but you do not want to do any kind of text processing in AppleScript — nor do you really want to do it by hand for tens of articles.</p><p>I decided on a Python text filter. Not entirely appropriate — we don&rsquo;t transform and return the text — but it&rsquo;s a dead simple way of working with the selection and removing it once we&rsquo;re done.</p><p>Using Python lets us do all sorts of wonderful things too other than just preparing the InDesign text to be entered into the fields. Here&rsquo;s the code, before I dive in any further:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=ch>#!/usr/local/bin/python3</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=n>names</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;Morning Star&#39;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>         <span class=o>...</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>         <span class=s1>&#39;A Reporter&#39;</span><span class=p>:</span> <span class=mi>1002</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>         <span class=p>}</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=n>length_lambdas</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;lead&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;func&#39;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>l</span><span class=p>:</span> <span class=mi>300</span> <span class=o>&lt;=</span> <span class=n>l</span> <span class=o>&lt;</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>                           <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>},</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>                  <span class=s1>&#39;2ndlead&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;func&#39;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>l</span><span class=p>:</span> <span class=mi>200</span> <span class=o>&lt;=</span> <span class=n>l</span> <span class=o>&lt;</span> <span class=mi>300</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>                              <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>},</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>                  <span class=s1>&#39;150word&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;func&#39;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>l</span><span class=p>:</span> <span class=mi>0</span> <span class=o>&lt;</span> <span class=n>l</span> <span class=o>&lt;</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>                              <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=mi>4</span><span class=p>},</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>                  <span class=s1>&#39;inbrief&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;func&#39;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>l</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>                              <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=mi>5</span><span class=p>},</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>                  <span class=s1>&#39;splash&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;func&#39;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>l</span><span class=p>:</span> <span class=mi>400</span> <span class=o>&lt;=</span> <span class=n>l</span><span class=p>,</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>                             <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=mi>6</span><span class=p>},</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1># Dr Drang&#39;s asrun function</span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1># http://www.leancrew.com/all-this/2013/03/combining-python-and-applescript/</span>
</span></span><span class=line><span class=ln>26</span><span class=cl><span class=k>def</span> <span class=nf>asrun</span><span class=p>(</span><span class=n>ascript</span><span class=p>):</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>  <span class=s2>&#34;Run the given AppleScript and return the standard output and error.&#34;</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>  <span class=n>osa</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>([</span><span class=s1>&#39;osascript&#39;</span><span class=p>,</span> <span class=s1>&#39;-&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>                          <span class=n>stdin</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>                          <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>                          <span class=n>stderr</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>DEVNULL</span><span class=p>)</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>  <span class=k>return</span> <span class=n>osa</span><span class=o>.</span><span class=n>communicate</span><span class=p>(</span><span class=n>ascript</span><span class=o>.</span><span class=n>encode</span><span class=p>())[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>
</span></span><span class=line><span class=ln>34</span><span class=cl>
</span></span><span class=line><span class=ln>35</span><span class=cl><span class=n>text</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>stdin</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=ln>36</span><span class=cl><span class=n>head</span><span class=p>,</span> <span class=n>standfirst</span><span class=p>,</span> <span class=n>author</span><span class=p>,</span> <span class=n>body</span> <span class=o>=</span> <span class=n>text</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>maxsplit</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=ln>37</span><span class=cl><span class=k>if</span> <span class=ow>not</span> <span class=n>standfirst</span><span class=p>:</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>  <span class=n>standfirst</span> <span class=o>=</span> <span class=s1>&#39; &#39;</span>           <span class=c1># Required. Don&#39;t ask</span>
</span></span><span class=line><span class=ln>39</span><span class=cl><span class=k>if</span> <span class=ow>not</span> <span class=n>author</span><span class=o>.</span><span class=n>strip</span><span class=p>():</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>  <span class=n>author</span> <span class=o>=</span> <span class=s1>&#39;Morning Star&#39;</span>
</span></span><span class=line><span class=ln>41</span><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>  <span class=n>author</span> <span class=o>=</span> <span class=n>author</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;by &#39;</span><span class=p>,</span> <span class=n>maxsplit</span><span class=o>=</span><span class=mi>1</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=ln>43</span><span class=cl><span class=n>name_id</span> <span class=o>=</span> <span class=n>names</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>author</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=ln>44</span><span class=cl><span class=n>words</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>body</span><span class=o>.</span><span class=n>split</span><span class=p>())</span>
</span></span><span class=line><span class=ln>45</span><span class=cl><span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>length_lambdas</span><span class=o>.</span><span class=n>values</span><span class=p>():</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>  <span class=k>if</span> <span class=n>v</span><span class=p>[</span><span class=s1>&#39;func&#39;</span><span class=p>](</span><span class=n>words</span><span class=p>):</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>    <span class=n>length_id</span> <span class=o>=</span> <span class=p>(</span><span class=n>v</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>
</span></span><span class=line><span class=ln>49</span><span class=cl><span class=n>wrapped_body</span> <span class=o>=</span> <span class=s1>&#39;&lt;p&gt;&#39;</span> <span class=o>+</span> <span class=s1>&#39;&lt;/p&gt;&lt;p&gt;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>body</span><span class=o>.</span><span class=n>splitlines</span><span class=p>())</span> <span class=o>+</span> <span class=s1>&#39;&lt;/p&gt;&#39;</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>
</span></span><span class=line><span class=ln>51</span><span class=cl>
</span></span><span class=line><span class=ln>52</span><span class=cl><span class=n>script</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=ln>53</span><span class=cl><span class=s2>tell application &#34;Safari&#34;
</span></span></span><span class=line><span class=ln>54</span><span class=cl><span class=s2>  tell the front document
</span></span></span><span class=line><span class=ln>55</span><span class=cl><span class=s2>    set js_head to &#34;$(&#39;#articleInputTitle&#39;).val(&#39;</span><span class=si>{head}</span><span class=s2>&#39;)&#34;
</span></span></span><span class=line><span class=ln>56</span><span class=cl><span class=s2>    set js_standfirst to &#34;$(&#39;#articleTextareaSummery&#39;).val(&#39;</span><span class=si>{standfirst}</span><span class=s2>&#39;)&#34;
</span></span></span><span class=line><span class=ln>57</span><span class=cl><span class=s2>    set js_body to &#34;$(&#39;#articleTextareaContent_ifr&#39;).contents().find(&#39;#tinymce&#39;).html(&#39;</span><span class=si>{body}</span><span class=s2>&#39;)&#34;
</span></span></span><span class=line><span class=ln>58</span><span class=cl><span class=s2>    set js_length to &#34;$(&#39;#articleSelectPosition&#39;).val(</span><span class=si>{length}</span><span class=s2>)&#34;
</span></span></span><span class=line><span class=ln>59</span><span class=cl><span class=s2>    set js_author to &#34;$(&#39;#articleSelectAuthor&#39;).val(</span><span class=si>{author}</span><span class=s2>)&#34;
</span></span></span><span class=line><span class=ln>60</span><span class=cl><span class=s2>    do JavaScript js_head
</span></span></span><span class=line><span class=ln>61</span><span class=cl><span class=s2>    do JavaScript js_standfirst
</span></span></span><span class=line><span class=ln>62</span><span class=cl><span class=s2>    do JavaScript js_body
</span></span></span><span class=line><span class=ln>63</span><span class=cl><span class=s2>    do JavaScript js_length
</span></span></span><span class=line><span class=ln>64</span><span class=cl><span class=s2>    do JavaScript js_author
</span></span></span><span class=line><span class=ln>65</span><span class=cl><span class=s2>  end tell
</span></span></span><span class=line><span class=ln>66</span><span class=cl><span class=s2>end tell
</span></span></span><span class=line><span class=ln>67</span><span class=cl><span class=s2>&#34;&#34;&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>head</span><span class=o>=</span><span class=n>head</span><span class=p>,</span> <span class=n>standfirst</span><span class=o>=</span><span class=n>standfirst</span><span class=p>,</span> <span class=n>body</span><span class=o>=</span><span class=n>wrapped_body</span><span class=p>,</span>
</span></span><span class=line><span class=ln>68</span><span class=cl>           <span class=n>length</span><span class=o>=</span><span class=n>length_id</span><span class=p>,</span> <span class=n>author</span><span class=o>=</span><span class=n>name_id</span><span class=p>)</span>
</span></span><span class=line><span class=ln>69</span><span class=cl>
</span></span><span class=line><span class=ln>70</span><span class=cl><span class=n>asrun</span><span class=p>(</span><span class=n>script</span><span class=p>)</span>
</span></span><span class=line><span class=ln>71</span><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>I like to put data at the top of my scripts and the code beneath, so let&rsquo;s start on line 35, where we read in the text from BBEdit. Line 36 breaks that text apart: I use a four-part structure, where the first line is the headline, then the standfirst and byline (both of which can be blank) and then any remaining lines form the body.</p><p>In line 43 we index into the names dictionary (abbreviated to protect the guilty, lines 6–9) using the cleaned-up byline, with 4 the value for the default author. This and the story type stuff below are presented as drop-down menus, which is where the integers come from.</p><p>Next we crudely count the words in the body to work out the story type, which are roughly differentiated by length. I iterate over a dictionary of lambdas instead of a lengthy <code>if-elif</code> block, mostly because it lets me use the dictionary keys to store the strings associated with the values. (You could do the same with comments in the <code>if-else</code>. I don&rsquo;t think there&rsquo;s a big advantage to either method.)</p><p>Note that the lambda for the &lsquo;inbrief&rsquo; type just returns False. We collect all of the brief stories into a single article on the web, with the total length anything from 100 words to over 600, and I couldn&rsquo;t think of an easy way to pick them out. I set the type for briefs by hand.</p><p>The last processing step is to wrap each line of the body with paragraph tags. (It&rsquo;s basic but it works!)</p><p>Then we format a string containing the AppleScript, which runs the JavaScript, and pass it to Dr Drang&rsquo;s <a href=http://www.leancrew.com/all-this/2013/03/combining-python-and-applescript/>asrun function</a> for execution.</p><p>And finally we print an empty string to delete the current selection in BBEdit — time to move on to the next story.</p><p>By using this script and opening up a dozen or two &rsquo;new article&rsquo; tabs in Safari, moving between each one and using the text filter to populate the fields, I can effectively do work in parallel instead of one task at a time — filling in new articles while I wait for the website to catch up and show the publishing time options. And no more copy & paste from TextEdit.</p></article></main><footer class=site-footer><small class=mute-links>This work is licensed under a
<a rel=license href=https://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a>.</small></footer></div></body></html>