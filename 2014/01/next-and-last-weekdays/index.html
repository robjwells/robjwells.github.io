<!doctype html><html lang=en><head><title>Primary Unit – Next and last weekdays</title><meta charset=utf-8><meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; media-src 'self'; block-all-mixed-content; base-uri 'self'"><link rel=license href=https://creativecommons.org/licenses/by/4.0/><link rel=alternate type=application/rss+xml href=/rss.xml title="Primary Unit"><link rel=alternate type=application/json href=/feed.json title="Primary Unit"><link rel=mask-icon href=/favicon.svg color=#1369bf><link rel=apple-touch-icon-precomposed href=/favicon.png><link rel=icon href=/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A blog by Rob Wells, mostly about computer stuff."><style>html,body,div,span,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,address,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strong,sub,sup,var,b,u,i,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,menu,nav,output,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font:inherit;vertical-align:baseline}input,button{font-family:inherit}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section{display:block}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}table{border-collapse:collapse;border-spacing:0}html{box-sizing:border-box;text-size-adjust:100%}*,*:before,*:after{box-sizing:inherit}:root{--grey:#607080;--grey10:#eff0f2;--grey5:#f7f8f9;--blue:#1369bf;--blue10:#e7eff8;--purple:#7436b3;--lineSpace:1.75rem;--halfLine:calc(var(--lineSpace) / 2);--quarterLine:calc(var(--lineSpace) / 4);--bigGap:calc(var(--lineSpace) * 2);--paragraphWidth:40rem;--wrapperWidth:50rem;--huge:1.75rem;--big:1.5625rem;--medium:1.375rem;--text:1.125rem;--small:0.875rem;--codeInText:0.875em;--bodyFonts:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Oxygen", Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Helvetica, sans-serif;--monospace:'Source Code Pro', 'Consolas', 'Menlo', 'Monaco', monospace}body{background-color:var(--grey5);font-family:var(--bodyFonts);font-size:var(--text);font-style:normal;font-weight:400;line-height:1.55555;text-size-adjust:100%;-webkit-text-size-adjust:100%}.wrapper{margin:0 auto;max-width:var(--wrapperWidth);padding:var(--lineSpace)var(--halfLine)}h2,h3,h4{margin:0 0 var(--lineSpace)}h2{font-size:var(--huge)}h3{font-size:var(--big)}h4{font-size:var(--medium)}blockquote,figure,p,pre,table,caption,dl,ol,ul,div.highlight{margin-bottom:var(--lineSpace)}blockquote,pre,div.highlight{background-color:var(--grey10);padding:var(--halfLine)}blockquote{font-style:italic}blockquote em,blockquote i{font-style:normal}blockquote p:last-child{margin-bottom:0}figcaption{font-style:italic}hr{border:none;border-top:1px solid var(--grey);margin:var(--lineSpace)0}img,video{box-sizing:content-box;border:1px solid var(--grey);height:auto;max-width:100%}pre{overflow-x:auto}dl,ol,ul{margin-bottom:var(--lineSpace)}ol,ul{list-style-position:outside;padding-left:var(--lineSpace)}ol{list-style-type:decimal}ul{list-style-type:square}a:link{color:var(--blue);text-decoration:underline}a:visited{color:var(--purple)}a:focus,a:hover,a:active{background-color:var(--blue10)}strong,b{font-weight:700}em,i{font-style:italic}code{font-size:var(--codeInText)}.highlight,pre code,small{font-size:var(--small)}.highlight,code{font-family:var(--monospace)}small{color:var(--grey)}table{width:100%}.table-container{overflow-x:auto}caption{font-style:italic}thead{border-bottom:1px solid var(--grey)}tfoot{border-top:1px solid var(--grey)}th,td{width:auto;padding:var(--halfLine);overflow:auto;text-align:left}th{background-color:var(--grey10);font-weight:700}.table-figures{text-align:right;font-family:var(--monospace)}.site-header{border-left:var(--quarterLine)solid var(--blue);display:flex;flex-wrap:wrap;margin-bottom:var(--lineSpace);padding-left:var(--quarterLine)}.site-title-container{flex-shrink:0;margin-right:var(--lineSpace);max-width:100%}.site-title{font-size:var(--huge);line-height:var(--huge);margin-bottom:0}.site-byline{margin-bottom:0}.site-links{color:var(--grey);list-style-type:none;margin-bottom:0;padding:0}.site-footer{margin-top:var(--bigGap)}article{border-bottom:1px solid var(--grey);margin-bottom:var(--bigGap)}article:last-of-type{border-bottom:none}article header{margin-bottom:var(--lineSpace)}article header h2{margin-bottom:0}article header time{color:var(--grey)}article li{margin-bottom:var(--halfLine)}.index-date{color:var(--grey);font-family:var(--monospace);font-size:var(--small);min-width:6rem;margin-right:var(--halfLine)}.index-item{margin-bottom:var(--halfLine)}.index-link{align-items:baseline;display:flex}.index-list{padding-left:0;list-style-type:none}.flag{background-color:var(--blue10);border-left:var(--quarterLine)solid var(--blue);margin-bottom:var(--lineSpace);padding:var(--halfLine)var(--quarterLine)}.flag :last-child{margin-bottom:0}.full-width{max-width:100%}.mute-links a{text-decoration:none;color:inherit}.no-border{border:0}.no-border img{border:0}.no-squish{overflow:auto}.no-squish img{max-width:none}@media screen and (min-width:40rem){.pull-left{float:left;clear:left;margin-right:var(--halfLine)}.pull-right{float:right;clear:right;margin-left:var(--halfLine)}.pull-left img,.pull-right img{display:block;margin-bottom:var(--lineSpace)}}</style><style>div.highlight>pre.chroma{padding:0;margin:0}:root{--lineNumberGrey:#6D6D6D;--operatorOrange:#B45000;--stringGreen:#357D06}.chroma .x{color:#000}.chroma .err{color:#a40000}.chroma .ln{margin-right:var(--halfLine);padding:0;color:var(--lineNumberGrey)}.chroma .k{color:#204a87;font-weight:700}.chroma .kc{color:#204a87;font-weight:700}.chroma .kd{color:#204a87;font-weight:700}.chroma .kn{color:#204a87;font-weight:700}.chroma .kp{color:#204a87;font-weight:700}.chroma .kr{color:#204a87;font-weight:700}.chroma .kt{color:#204a87;font-weight:700}.chroma .n{color:#000}.chroma .na{color:#c4a000}.chroma .nb{color:#204a87}.chroma .bp{color:#3465a4}.chroma .nc{color:#000}.chroma .no{color:#000}.chroma .nd{color:#5c35cc;font-weight:700}.chroma .ni{color:var(--operatorOrange)}.chroma .ne{color:#c00;font-weight:700}.chroma .nf{color:#000}.chroma .fm{color:#000}.chroma .nl{color:#f57900}.chroma .nn{color:#000}.chroma .nx{color:#000}.chroma .py{color:#000}.chroma .nt{color:#204a87;font-weight:700}.chroma .nv{color:#000}.chroma .vc{color:#000}.chroma .vg{color:#000}.chroma .vi{color:#000}.chroma .vm{color:#000}.chroma .l{color:#000}.chroma .ld{color:#000}.chroma .s{color:var(--stringGreen)}.chroma .sa{color:var(--stringGreen)}.chroma .sb{color:var(--stringGreen)}.chroma .sc{color:var(--stringGreen)}.chroma .dl{color:var(--stringGreen)}.chroma .sd{color:#8f5902;font-style:italic}.chroma .s2{color:var(--stringGreen)}.chroma .se{color:var(--stringGreen)}.chroma .sh{color:var(--stringGreen)}.chroma .si{color:var(--stringGreen)}.chroma .sx{color:var(--stringGreen)}.chroma .sr{color:var(--stringGreen)}.chroma .s1{color:var(--stringGreen)}.chroma .ss{color:var(--stringGreen)}.chroma .m{color:#0000cf;font-weight:700}.chroma .mb{color:#0000cf;font-weight:700}.chroma .mf{color:#0000cf;font-weight:700}.chroma .mh{color:#0000cf;font-weight:700}.chroma .mi{color:#0000cf;font-weight:700}.chroma .il{color:#0000cf;font-weight:700}.chroma .mo{color:#0000cf;font-weight:700}.chroma .o{color:var(--operatorOrange);font-weight:700}.chroma .ow{color:#204a87;font-weight:700}.chroma .p{color:#000;font-weight:700}.chroma .c{color:#8f5902;font-style:italic}.chroma .ch{color:#8f5902;font-style:italic}.chroma .cm{color:#8f5902;font-style:italic}.chroma .c1{color:#8f5902;font-style:italic}.chroma .cs{color:#8f5902;font-style:italic}.chroma .cp{color:#8f5902;font-style:italic}.chroma .cpf{color:#8f5902;font-style:italic}.chroma .g{color:#000}.chroma .gd{color:#a40000}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#ef2929}.chroma .gh{color:navy;font-weight:700}.chroma .gi{color:#00a000}.chroma .go{color:#000;font-style:italic}.chroma .gp{color:#8f5902}.chroma .gs{color:#000;font-weight:700}.chroma .gu{color:purple;font-weight:700}.chroma .gt{color:#a40000;font-weight:700}.chroma .gl{color:#000;text-decoration:underline}.chroma .w{color:#f8f8f8;text-decoration:none}</style></head><body><div class=wrapper><header class=site-header><div class="site-title-container mute-links"><h1 class=site-title><a href=/>Primary Unit</a></h1><p class=site-byline><i>by</i> Rob Wells</p></div><nav id=site-nav><ul class="site-links mute-links"><li><a href=/about/>About</a></li><li><a href=/books/>Books I’ve read</a></li><li>Feed:
<a href=/feed.json>JSON</a>,
<a href=/rss.xml>RSS</a></li></ul></nav></header><main><article><header><h2 class=mute-links><a href=/2014/01/next-and-last-weekdays/>Next and last weekdays</a></h2><p><time datetime=2014-01-11T16:08:00+0000>Saturday, January 11 2014</time></p></header><p>I was recently reminded of David Sparks’s <a href=http://macsparky.com/blog/2013/5/text-expander-snippets-date-and-time>TextExpander date snippets</a>, the most interesting of which use AppleScript to insert the date for the next occurrence of a certain weekday. (And were <a href=http://www.tuaw.com/2013/01/21/mac-productivity-ten-textexpander-date-snippets/>written by Ben Waldie</a>.)</p><p>Out of curiosity, I wrote a Python command-line tool called dayshift that does something similar. Its main differences are that it doesn’t have to be set up for specific days like the AppleScript snippets, and that it can find the date for a past weekday (“last Monday”) as well as a future one (“next Monday”).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=ch>#!/usr/local/bin/python3</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=s2>Print the date of the next or last specified weekday.
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=s2>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=s2>Usage:
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=s2>  dayshift next &lt;weekday&gt; [--format=&lt;fmt&gt; --inline]
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=s2>  dayshift last &lt;weekday&gt; [--format=&lt;fmt&gt; --inline]
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=s2>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=s2>Options:
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=s2>  --format=&lt;fmt&gt;, -f &lt;fmt&gt;  A strftime format string
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=s2>                            [default: %Y-%m-</span><span class=si>%d</span><span class=s2>]
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=s2>  --inline, -i              Omit trailing newline
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=s2>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=kn>from</span> <span class=nn>docopt</span> <span class=kn>import</span> <span class=n>docopt</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>date</span><span class=p>,</span> <span class=n>timedelta</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=n>WEEKDAYS</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;mon&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;tue&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;wed&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span> <span class=s1>&#39;thu&#39;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>            <span class=s1>&#39;fri&#39;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span> <span class=s1>&#39;sat&#39;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span> <span class=s1>&#39;sun&#39;</span><span class=p>:</span> <span class=mi>6</span><span class=p>}</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=n>args</span> <span class=o>=</span> <span class=n>docopt</span><span class=p>(</span><span class=vm>__doc__</span><span class=p>)</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=n>starting_offset</span> <span class=o>=</span> <span class=mi>2</span> <span class=k>if</span> <span class=n>args</span><span class=p>[</span><span class=s1>&#39;next&#39;</span><span class=p>]</span> <span class=k>else</span> <span class=o>-</span><span class=mi>2</span>
</span></span><span class=line><span class=ln>23</span><span class=cl><span class=n>start_date</span> <span class=o>=</span> <span class=n>date</span><span class=o>.</span><span class=n>today</span><span class=p>()</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>starting_offset</span><span class=p>)</span>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=n>start_integer</span> <span class=o>=</span> <span class=n>start_date</span><span class=o>.</span><span class=n>weekday</span><span class=p>()</span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=n>target_integer</span> <span class=o>=</span> <span class=n>WEEKDAYS</span><span class=p>[</span><span class=n>args</span><span class=p>[</span><span class=s1>&#39;&lt;weekday&gt;&#39;</span><span class=p>][:</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>lower</span><span class=p>()]</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=k>if</span> <span class=n>args</span><span class=p>[</span><span class=s1>&#39;next&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>  <span class=n>offset</span> <span class=o>=</span> <span class=n>target_integer</span> <span class=o>-</span> <span class=n>start_integer</span>
</span></span><span class=line><span class=ln>29</span><span class=cl><span class=k>elif</span> <span class=n>args</span><span class=p>[</span><span class=s1>&#39;last&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>  <span class=n>offset</span> <span class=o>=</span> <span class=n>start_integer</span> <span class=o>-</span> <span class=n>target_integer</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>
</span></span><span class=line><span class=ln>32</span><span class=cl><span class=k>if</span> <span class=n>offset</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>  <span class=n>offset</span> <span class=o>+=</span> <span class=mi>7</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>
</span></span><span class=line><span class=ln>35</span><span class=cl><span class=k>if</span> <span class=n>args</span><span class=p>[</span><span class=s1>&#39;last&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>  <span class=n>offset</span> <span class=o>/=</span> <span class=o>-</span><span class=mi>1</span>    <span class=c1># Make the offset negative</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>
</span></span><span class=line><span class=ln>38</span><span class=cl><span class=n>target_date</span> <span class=o>=</span> <span class=n>start_date</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>offset</span><span class=p>)</span>
</span></span><span class=line><span class=ln>39</span><span class=cl><span class=n>ending</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span> <span class=k>if</span> <span class=n>args</span><span class=p>[</span><span class=s1>&#39;--inline&#39;</span><span class=p>]</span> <span class=k>else</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=ln>40</span><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>target_date</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=s1>&#39;--format&#39;</span><span class=p>]),</span> <span class=n>end</span><span class=o>=</span><span class=n>ending</span><span class=p>)</span>
</span></span></code></pre></div><div class=flag id=update_2014-01-13><p><strong>Update <time>2014-01-13</time></strong></p><p>I’ve added an offset to the starting day (lines 22 & 23) to skip past the two days before and after the current date. The line numbers in the explanation below have been altered to match.</p><p>You might like to look at the <a href=https://gist.github.com/robjwells/8370699>corresponding Gist</a> in case I’ve made any further changes.</p></div><p>The interface is created by <a href=http://docopt.org>docopt</a> in line 21 from the script’s docstring (lines 2–14).</p><p>After parsing the arguments we reduce the given weekday to its integer representation in line 25 by getting its first three characters, converting them to lowercase and using that string to key into the <code>WEEKDAYS</code> dictionary (lines 18 & 19).</p><p>On line 24 we get the integer for a starting date which is offset forward or backward by two days (lines 22 & 23). You can adjust the forward and backward offsets separately, depending on where you draw the line.</p><p>Now the <code>next</code> and <code>last</code> commands come into play, deciding how we compare the two weekday integers (lines 27–30). In both instances we can end up with 0 or a negative number so we add 7 to the offset (line 33).</p><p>But surely we want a negative number if we’re after the “last” weekday? Yes, but not just yet — at this point it tells us that we’ve passed the given weekday in the current week (if <code>next</code>) or the given weekday is still to come (if <code>last</code>). We add 7 to move outside of the current week.</p><p>To ensure we go back in time we specifically invert the offset in line 36, before adding it to the starting date in line 38 to reach the target date.</p><p>Now the two options shown in the docstring come into play. Line 39 uses the <code>--inline</code> flag to determine whether the printed string ends in a newline or not — handy when the script is called by a snippet inserted in the middle of some text.</p><p>The other option, <code>--format</code>, determines how the date is printed. I use docopt’s ability to have default values (see line 11) to print an <a href=http://en.wikipedia.org/wiki/ISO_8601>ISO 8601 date</a> if another format isn’t given. This lets me pass the argument directly to <code>strftime</code> in line 40.</p><h3 id=using-the-script-in-textexpander>Using the script in TextExpander</h3><p>The script works great as a command-line utility:</p><pre tabindex=0><code>$ dayshift next Wednesday
2014-01-15
$ dayshift last Wednesday
2014-01-08
</code></pre><p>But, returning to the original use case, I recommend two approaches.</p><p>You can set up individual snippets to find the next or last occurrence of a certain weekday. Add a new shell script snippet, with code similar to this:</p><pre tabindex=0><code>#!/bin/bash
/path/to/dayshift next Monday -i
</code></pre><p>Or you can use TextExpander’s fill-in feature to let you pick the options on the fly (line breaks inserted for readability):</p><pre tabindex=0><code>#!/bin/bash
/path/to/dayshift %fillpopup:name=Next/Last:default=next:last%
%fillpopup:name=Weekday:default=Monday:Tuesday:
Wednesday:Thursday:Friday:Saturday:Sunday% -i
</code></pre><p>That looks pretty gross there, and it doesn’t look good in use either:</p><p><img src=/images/2014-01-11_weekdaysfillin.png alt="Screenshot of the dayshift fill-in TextExpander snippet"></p><p>But it gives you a lot of control and you can tab between the fields.</p><div class=flag id=update_2014-01-12><p><strong>Update <time>2014-01-12</time></strong></p><p>Shortly after posting this yesterday, <a href=http://leancrew.com/all-this/>Dr Drang</a> sent me a nice email pointing out a <a href=http://www.leancrew.com/all-this/2012/09/eight-days-a-week/#comment-24659>comment by Dave Cross</a> on how to use the <code>date</code> utility in Unix to similar effect, which in its simplest form is <code>date -v+weds</code> (to get next Wednesday’s date).</p><p>I recommend reading <a href=http://www.leancrew.com/all-this/2012/09/eight-days-a-week/>the entire post</a> that comment is in reply to as it addresses a very similar situation to the one above, but with an illuminating look at working with weekdays as integers.</p></div></article></main><footer class=site-footer><small class=mute-links>This work is licensed under a
<a rel=license href=https://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a>.</small></footer></div></body></html>