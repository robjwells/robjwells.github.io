<!doctype html><html lang=en>
<head>
<title>Primary Unit – InDesign PDF metastasis</title>
<meta charset=utf-8>
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; media-src 'self'; block-all-mixed-content; base-uri 'self'">
<link rel=license href=https://creativecommons.org/licenses/by/4.0/>
<link rel=alternate type=application/rss+xml href=/rss.xml title="Primary Unit">
<link rel=alternate type=application/json href=/feed.json title="Primary Unit">
<link rel=mask-icon href=/favicon.svg color=#1369bf>
<link rel=apple-touch-icon-precomposed href=/favicon.png>
<link rel=icon href=/favicon.ico>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="A blog by Rob Wells, mostly about computer stuff.">
<style>html,body,div,span,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,address,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strong,sub,sup,var,b,u,i,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,menu,nav,output,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font:inherit;vertical-align:baseline}input,button{font-family:inherit}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section{display:block}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}table{border-collapse:collapse;border-spacing:0}html{box-sizing:border-box;text-size-adjust:100%}*,*:before,*:after{box-sizing:inherit}:root{--grey:#607080;--grey10:#eff0f2;--grey5:#f7f8f9;--blue:#1369bf;--blue10:#e7eff8;--purple:#7436b3;--lineSpace:1.75rem;--halfLine:calc(var(--lineSpace) / 2);--quarterLine:calc(var(--lineSpace) / 4);--bigGap:calc(var(--lineSpace) * 2);--paragraphWidth:40rem;--wrapperWidth:50rem;--huge:1.75rem;--big:1.5625rem;--medium:1.375rem;--text:1.125rem;--small:0.875rem;--codeInText:0.875em;--bodyFonts:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Oxygen", Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Helvetica, sans-serif;--monospace:'Source Code Pro', 'Consolas', 'Menlo', 'Monaco', monospace}body{background-color:var(--grey5);font-family:var(--bodyFonts);font-size:var(--text);font-style:normal;font-weight:400;line-height:1.55555;text-size-adjust:100%;-webkit-text-size-adjust:100%}.wrapper{margin:0 auto;max-width:var(--wrapperWidth);padding:var(--lineSpace)var(--halfLine)}h2,h3,h4{margin:0 0 var(--lineSpace)}h2{font-size:var(--huge)}h3{font-size:var(--big)}h4{font-size:var(--medium)}blockquote,figure,p,pre,table,caption,dl,ol,ul,div.highlight{margin-bottom:var(--lineSpace)}blockquote,pre,div.highlight{background-color:var(--grey10);padding:var(--halfLine)}blockquote{font-style:italic}blockquote em,blockquote i{font-style:normal}blockquote p:last-child{margin-bottom:0}figcaption{font-style:italic}hr{border:none;border-top:1px solid var(--grey);margin:var(--lineSpace)0}img,video{box-sizing:content-box;border:1px solid var(--grey);height:auto;max-width:100%}pre{overflow-x:auto}dl,ol,ul{margin-bottom:var(--lineSpace)}ol,ul{list-style-position:outside;padding-left:var(--lineSpace)}ol{list-style-type:decimal}ul{list-style-type:square}a:link{color:var(--blue);text-decoration:underline}a:visited{color:var(--purple)}a:focus,a:hover,a:active{background-color:var(--blue10)}strong,b{font-weight:700}em,i{font-style:italic}code{font-size:var(--codeInText)}.highlight,pre code,small{font-size:var(--small)}.highlight,code{font-family:var(--monospace)}small{color:var(--grey)}table{width:100%}.table-container{overflow-x:auto}caption{font-style:italic}thead{border-bottom:1px solid var(--grey)}tfoot{border-top:1px solid var(--grey)}th,td{width:auto;padding:var(--halfLine);overflow:auto;text-align:left}th{background-color:var(--grey10);font-weight:700}.table-figures{text-align:right;font-family:var(--monospace)}.site-header{border-left:var(--quarterLine)solid var(--blue);display:flex;flex-wrap:wrap;margin-bottom:var(--lineSpace);padding-left:var(--quarterLine)}.site-title-container{flex-shrink:0;margin-right:var(--lineSpace);max-width:100%}.site-title{font-size:var(--huge);line-height:var(--huge);margin-bottom:0}.site-byline{margin-bottom:0}.site-links{color:var(--grey);list-style-type:none;margin-bottom:0;padding:0}.site-footer{margin-top:var(--bigGap)}article{border-bottom:1px solid var(--grey);margin-bottom:var(--bigGap)}article:last-of-type{border-bottom:none}article header{margin-bottom:var(--lineSpace)}article header h2{margin-bottom:0}article header time{color:var(--grey)}article li{margin-bottom:var(--halfLine)}.index-date{color:var(--grey);font-family:var(--monospace);font-size:var(--small);min-width:6rem;margin-right:var(--halfLine)}.index-item{margin-bottom:var(--halfLine)}.index-link{align-items:baseline;display:flex}.index-list{padding-left:0;list-style-type:none}.flag{background-color:var(--blue10);border-left:var(--quarterLine)solid var(--blue);margin-bottom:var(--lineSpace);padding:var(--halfLine)var(--quarterLine)}.flag :last-child{margin-bottom:0}.full-width{max-width:100%}.mute-links a{text-decoration:none;color:inherit}.no-border{border:0}.no-border img{border:0}.no-squish{overflow:auto}.no-squish img{max-width:none}@media screen and (min-width:40rem){.pull-left{float:left;clear:left;margin-right:var(--halfLine)}.pull-right{float:right;clear:right;margin-left:var(--halfLine)}.pull-left img,.pull-right img{display:block;margin-bottom:var(--lineSpace)}}</style>
<style>div.highlight>pre.chroma{padding:0;margin:0}:root{--lineNumberGrey:#6D6D6D;--operatorOrange:#B45000;--stringGreen:#357D06}.chroma .x{color:#000}.chroma .err{color:#a40000}.chroma .ln{margin-right:var(--halfLine);padding:0;color:var(--lineNumberGrey)}.chroma .k{color:#204a87;font-weight:700}.chroma .kc{color:#204a87;font-weight:700}.chroma .kd{color:#204a87;font-weight:700}.chroma .kn{color:#204a87;font-weight:700}.chroma .kp{color:#204a87;font-weight:700}.chroma .kr{color:#204a87;font-weight:700}.chroma .kt{color:#204a87;font-weight:700}.chroma .n{color:#000}.chroma .na{color:#c4a000}.chroma .nb{color:#204a87}.chroma .bp{color:#3465a4}.chroma .nc{color:#000}.chroma .no{color:#000}.chroma .nd{color:#5c35cc;font-weight:700}.chroma .ni{color:var(--operatorOrange)}.chroma .ne{color:#c00;font-weight:700}.chroma .nf{color:#000}.chroma .fm{color:#000}.chroma .nl{color:#f57900}.chroma .nn{color:#000}.chroma .nx{color:#000}.chroma .py{color:#000}.chroma .nt{color:#204a87;font-weight:700}.chroma .nv{color:#000}.chroma .vc{color:#000}.chroma .vg{color:#000}.chroma .vi{color:#000}.chroma .vm{color:#000}.chroma .l{color:#000}.chroma .ld{color:#000}.chroma .s{color:var(--stringGreen)}.chroma .sa{color:var(--stringGreen)}.chroma .sb{color:var(--stringGreen)}.chroma .sc{color:var(--stringGreen)}.chroma .dl{color:var(--stringGreen)}.chroma .sd{color:#8f5902;font-style:italic}.chroma .s2{color:var(--stringGreen)}.chroma .se{color:var(--stringGreen)}.chroma .sh{color:var(--stringGreen)}.chroma .si{color:var(--stringGreen)}.chroma .sx{color:var(--stringGreen)}.chroma .sr{color:var(--stringGreen)}.chroma .s1{color:var(--stringGreen)}.chroma .ss{color:var(--stringGreen)}.chroma .m{color:#0000cf;font-weight:700}.chroma .mb{color:#0000cf;font-weight:700}.chroma .mf{color:#0000cf;font-weight:700}.chroma .mh{color:#0000cf;font-weight:700}.chroma .mi{color:#0000cf;font-weight:700}.chroma .il{color:#0000cf;font-weight:700}.chroma .mo{color:#0000cf;font-weight:700}.chroma .o{color:var(--operatorOrange);font-weight:700}.chroma .ow{color:#204a87;font-weight:700}.chroma .p{color:#000;font-weight:700}.chroma .c{color:#8f5902;font-style:italic}.chroma .ch{color:#8f5902;font-style:italic}.chroma .cm{color:#8f5902;font-style:italic}.chroma .c1{color:#8f5902;font-style:italic}.chroma .cs{color:#8f5902;font-style:italic}.chroma .cp{color:#8f5902;font-style:italic}.chroma .cpf{color:#8f5902;font-style:italic}.chroma .g{color:#000}.chroma .gd{color:#a40000}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#ef2929}.chroma .gh{color:navy;font-weight:700}.chroma .gi{color:#00a000}.chroma .go{color:#000;font-style:italic}.chroma .gp{color:#8f5902}.chroma .gs{color:#000;font-weight:700}.chroma .gu{color:purple;font-weight:700}.chroma .gt{color:#a40000;font-weight:700}.chroma .gl{color:#000;text-decoration:underline}.chroma .w{color:#f8f8f8;text-decoration:underline}</style>
</head>
<body>
<div class=wrapper>
<header class=site-header>
<div class="site-title-container mute-links">
<h1 class=site-title><a href=/>Primary Unit</a></h1>
<p class=site-byline><i>by</i> Rob Wells</p>
</div>
<nav id=site-nav>
<ul class="site-links mute-links">
<li><a href=/about/>About</a></li>
<li><a href=/books/>Books I’ve read</a></li>
<li>
Feed:
<a href=/feed.json>JSON</a>,
<a href=/rss.xml>RSS</a>
</li>
</ul>
</nav>
</header>
<main>
<article>
<header>
<h2 class=mute-links><a href=/2017/04/indesign-pdf-metastasis/>InDesign PDF metastasis</a></h2>
<p><time datetime=2017-04-17T22:25:00+0000>Monday, April 17 2017</time></p>
</header>
<p>At work we deal a lot with PDFs, both press quality and low-quality for viewing on screen. Over time I’ve automated a fair amount of the creation for both types, but one thing that I haven’t yet done is automate file-size reductions for the low-quality PDFs.</p>
<p>(We still use InDesign CS4 at work, so bear in mind that some or all of the below may not apply to more recent versions.)</p>
<p>It’s interesting to look at exactly what is making the files large enough to require slimming down in the first place. All our low-quality PDFs are exported from InDesign with the built-in “Smallest file size” preset, but the sizes are usually around 700kB for single tabloid-sized, image-sparse pages.</p>
<p><img src=/images/2017-04-17-arts-full.jpg class=pull-right alt="A low-quality image of a Morning Star arts page."></p>
<p>Let’s take Tuesday’s arts page as our example. It’s pretty basic: two small images and a medium-sized one, two drop shadows, one transparency and a fair amount of text. (That line of undermatter in the lead article was corrected before we went to print.)</p>
<p>But exporting using InDesign’s lowest-quality PDF preset creates a 715kB file. The images are small and rendered at a low DPI, so they’re not inflating the file.</p>
<p>Thankfully you can have a poke around PDF files with your favourite text editor (<a href=http://www.barebones.com/products/bbedit/>BBEdit</a>, obviously). You’ll find a lot of “garbage” text, which I imagine is chunks of binary data, but there’s plenty of plain text you can read. The big chunks tend to be metadata. Here’s part of the first metadata block in the PDF file for the arts page:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;x:xmpmeta</span> <span class=na>xmlns:x=</span><span class=s>&#34;adobe:ns:meta/&#34;</span> <span class=na>x:xmptk=</span><span class=s>&#34;Adobe XMP […]&#34;</span><span class=nt>&gt;</span>
 <span class=nt>&lt;rdf:RDF</span> <span class=na>xmlns:rdf=</span><span class=s>&#34;http://www.w3.org/1999/02/22-rdf-syntax-ns#&#34;</span><span class=nt>&gt;</span>
  <span class=nt>&lt;rdf:Description</span> <span class=na>rdf:about=</span><span class=s>&#34;&#34;</span>
    <span class=na>xmlns:xmp=</span><span class=s>&#34;http://ns.adobe.com/xap/1.0/&#34;</span>
    <span class=na>xmlns:dc=</span><span class=s>&#34;http://purl.org/dc/elements/1.1/&#34;</span>
    <span class=na>xmlns:photoshop=</span><span class=s>&#34;http://ns.adobe.com/photoshop/1.0/&#34;</span>
    <span class=err>…</span> <span class=err>Blah</span> <span class=err>blah</span> <span class=err>blah</span> <span class=err>exif</span> <span class=err>data</span> <span class=err>etc</span> <span class=err>…</span>
  <span class=err>&lt;/rdf:Description</span><span class=nt>&gt;</span>
 <span class=nt>&lt;/rdf:RDF&gt;</span>
<span class=nt>&lt;/x:xmpmeta&gt;</span>
</code></pre></div><p>Which is the none-too-exciting block for one of the images, a Photoshop file. There’s two more like this, roughly 50–100 lines each. Then we hit a chunk which describes the InDesign file itself, with this giveaway line:</p>
<pre><code>xml:
&lt;xmp:CreatorTool&gt;Adobe InDesign CS4 (6.0.6)&lt;/xmp:CreatorTool&gt;
</code></pre>
<p>So what, right? InDesign includes some document and image metadata when it exports a PDF. Sure, yeah. I mean, the metadata blocks for the images weren’t too long, and this is just about their container.</p>
<p>Except this InDesign metadata block is 53,895 lines long in a file that’s 86,585 lines long. 574,543 characters of the document’s 714,626 — 80% of the file.</p>
<p>I think it’s safe to say we’ve found our culprit. But what’s going on in those 54,000 lines? Well, mostly this:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;xmpMM:History&gt;</span>
   <span class=nt>&lt;rdf:Seq&gt;</span>
      <span class=nt>&lt;rdf:li</span> <span class=na>rdf:parseType=</span><span class=s>&#34;Resource&#34;</span><span class=nt>&gt;</span>
         <span class=nt>&lt;stEvt:action&gt;</span>created<span class=nt>&lt;/stEvt:action&gt;</span>
         <span class=nt>&lt;stEvt:instanceID&gt;</span>xmp.iid:[… hex ID …]<span class=nt>&lt;/stEvt:instanceID&gt;</span>
         <span class=nt>&lt;stEvt:when&gt;</span>2012-05-22T12:55:27+01:00<span class=nt>&lt;/stEvt:when&gt;</span>
         <span class=nt>&lt;stEvt:softwareAgent&gt;</span>Adobe InDesign 6.0<span class=nt>&lt;/stEvt:softwareAgent&gt;</span>
      <span class=nt>&lt;/rdf:li&gt;</span>
      <span class=nt>&lt;rdf:li</span> <span class=na>rdf:parseType=</span><span class=s>&#34;Resource&#34;</span><span class=nt>&gt;</span>
         <span class=nt>&lt;stEvt:action&gt;</span>saved<span class=nt>&lt;/stEvt:action&gt;</span>
         <span class=nt>&lt;stEvt:instanceID&gt;</span>xmp.iid:[… hex ID …]<span class=nt>&lt;/stEvt:instanceID&gt;</span>
         <span class=nt>&lt;stEvt:when&gt;</span>2012-05-22T12:55:54+01:00<span class=nt>&lt;/stEvt:when&gt;</span>
         <span class=nt>&lt;stEvt:softwareAgent&gt;</span>Adobe InDesign 6.0<span class=nt>&lt;/stEvt:softwareAgent&gt;</span>
         <span class=nt>&lt;stEvt:changed&gt;</span>/<span class=nt>&lt;/stEvt:changed&gt;</span>
      <span class=nt>&lt;/rdf:li&gt;</span>
    <span class=c>&lt;!--  1,287 more list items  --&gt;</span>
   <span class=nt>&lt;/rdf:Seq&gt;</span>
<span class=nt>&lt;/xmpMM:History&gt;</span>
</code></pre></div><p>It’s effectively a record of every time the document was saved. But if you look at the <code>stEvt:when</code> tag you’ll notice the first items are from 2012 — when our “master” InDesign file from which we derive our edition files was first created. So, the whole record of that master file is included in every InDesign file we use, and the PDFs we create from them.</p>
<p>Can we remove this metadata from InDesign? You can see it in <span class=osx-menu>File ▸ File Info… ▸ Advanced</span>, select it and press the rubbish bin icon. Save, quit, reopen and… it’s still there.</p>
<p>Thankfully Acrobat can remove this stuff from your final PDF, by going through the “PDF Optimizer” or “Save Optimized PDF” or whatever menu item it’s hiding under these days. (In the “Audit Space Usage” window it corresponds to the “Document Overhead”.)</p>
<p>Unfortunately Acrobat’s AppleScript support has always been poor — I’ve no idea what it’s like now, remember we’re talking CS4 — and I’ve no time nor desire to dive into Adobe’s JavaScript interface. So while you can (and we do) automate the PDF exports, you can’t slim these files down automatically with Acrobat.</p>
<p>Our solution at work has been to cut the cruft from the PDF using Acrobat when we use it to combine our separate page PDFs by hand. But ultimately I want to automate the whole process of exporting the PDFs, stitching them together in order, and reducing the file size.</p>
<p>After using <a href=https://ghostscript.com>ghostscript</a> for our <a href=https://github.com/ppps/ms-barcode>automatic barcode creation</a>, I twigged that it would be useful for processing the PDFs after creation, and sure enough you can use it to slim down PDFs. Here’s an example command:</p>
<pre tabindex=0><code>gs -sDEVICE=pdfwrite \
   -dPDFSETTINGS=/screen \
   -dCompatibilityLevel=1.5 \
   -dNOPAUSE -dQUIET -dBATCH \
   -sOutputFile=&quot;11_Books_180417-smaller.pdf&quot; \
   &quot;11_Books_180417.pdf&quot;
</code></pre><p>Most of that is ghostscript boilerplate (it’s not exactly the friendliest tool to use), but the important option is <code>-dPDFSETTINGS=/screen</code> which, according to <a href=https://ghostscript.com/doc/9.14/Ps2pdf.htm#Options>one page of the sprawling docs</a>, is a predefined Adobe Distiller setting.</p>
<p>Using it on our 715kB example spits out an 123kB PDF that is visually identical apart from mangling the drop shadows (which I think can be solved by changing the transparency flattening settings when the PDF is exported from InDesign).</p>
</article>
</main>
<footer class=site-footer>
<small class=mute-links>
This work is licensed under a
<a rel=license href=https://creativecommons.org/licenses/by/4.0/>
Creative Commons Attribution 4.0 International License</a>.
</small>
</footer>
</div>
</body>
</html>