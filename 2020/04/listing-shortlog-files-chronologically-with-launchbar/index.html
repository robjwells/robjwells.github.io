<!doctype html><html lang=en><head><title>Primary Unit – Listing shortlog files chronologically with LaunchBar</title><meta charset=utf-8><meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; media-src 'self'; block-all-mixed-content; base-uri 'self'"><link rel=license href=https://creativecommons.org/licenses/by/4.0/><link rel=alternate type=application/rss+xml href=/rss.xml title="Primary Unit"><link rel=alternate type=application/json href=/feed.json title="Primary Unit"><link rel=mask-icon href=/favicon.svg color=#1369bf><link rel=apple-touch-icon-precomposed href=/favicon.png><link rel=icon href=/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A blog by Rob Wells, mostly about computer stuff."><style>html,body,div,span,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,address,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strong,sub,sup,var,b,u,i,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,menu,nav,output,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font:inherit;vertical-align:baseline}input,button{font-family:inherit}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section{display:block}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}table{border-collapse:collapse;border-spacing:0}html{box-sizing:border-box;text-size-adjust:100%}*,*:before,*:after{box-sizing:inherit}:root{--grey: #607080;--grey10: #eff0f2;--grey5: #f7f8f9;--blue: #1369bf;--blue10: #e7eff8;--purple: #7436b3;--lineSpace: 1.75rem;--halfLine: calc(var(--lineSpace) / 2);--quarterLine: calc(var(--lineSpace) / 4);--bigGap: calc(var(--lineSpace) * 2);--paragraphWidth: 40rem;--wrapperWidth: 50rem;--huge: 1.75rem;--big: 1.5625rem;--medium: 1.375rem;--text: 1.125rem;--small: 0.875rem;--codeInText: 0.875em;--bodyFonts: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Oxygen", Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Helvetica, sans-serif;--monospace: 'Source Code Pro', 'Consolas', 'Menlo', 'Monaco', monospace}body{background-color:var(--grey5);font-family:var(--bodyFonts);font-size:var(--text);font-style:normal;font-weight:400;line-height:1.55555;text-size-adjust:100%;-webkit-text-size-adjust:100%}.wrapper{margin:0 auto;max-width:var(--wrapperWidth);padding:var(--lineSpace)var(--halfLine)}h2,h3,h4{margin:0 0 var(--lineSpace)}h2{font-size:var(--huge)}h3{font-size:var(--big)}h4{font-size:var(--medium)}blockquote,figure,p,pre,table,caption,dl,ol,ul,div.highlight{margin-bottom:var(--lineSpace)}blockquote,pre,div.highlight{background-color:var(--grey10);padding:var(--halfLine)}blockquote{font-style:italic}blockquote em,blockquote i{font-style:normal}blockquote p:last-child{margin-bottom:0}figcaption{font-style:italic}hr{border:none;border-top:1px solid var(--grey);margin:var(--lineSpace)0}img,video{box-sizing:content-box;border:1px solid var(--grey);height:auto;max-width:100%}pre{overflow-x:auto}dl,ol,ul{margin-bottom:var(--lineSpace)}ol,ul{list-style-position:outside;padding-left:var(--lineSpace)}ol{list-style-type:decimal}ul{list-style-type:square}a:link{color:var(--blue);text-decoration:underline}a:visited{color:var(--purple)}a:focus,a:hover,a:active{background-color:var(--blue10)}strong,b{font-weight:700}em,i{font-style:italic}code{font-size:var(--codeInText)}.highlight,pre code,small{font-size:var(--small)}.highlight,code{font-family:var(--monospace)}small{color:var(--grey)}table{width:100%}.table-container{overflow-x:auto}caption{font-style:italic}thead{border-bottom:1px solid var(--grey)}tfoot{border-top:1px solid var(--grey)}th,td{width:auto;padding:var(--halfLine);overflow:auto;text-align:left}th{background-color:var(--grey10);font-weight:700}.table-figures{text-align:right;font-family:var(--monospace)}.site-header{border-left:var(--quarterLine)solid var(--blue);display:flex;flex-wrap:wrap;margin-bottom:var(--lineSpace);padding-left:var(--quarterLine)}.site-title-container{flex-shrink:0;margin-right:var(--lineSpace);max-width:100%}.site-title{font-size:var(--huge);line-height:var(--huge);margin-bottom:0}.site-byline{margin-bottom:0}.site-links{color:var(--grey);list-style-type:none;margin-bottom:0;padding:0}.site-footer{margin-top:var(--bigGap)}article{border-bottom:1px solid var(--grey);margin-bottom:var(--bigGap)}article:last-of-type{border-bottom:none}article header{margin-bottom:var(--lineSpace)}article header h2{margin-bottom:0}article header time{color:var(--grey)}article p{max-width:var(--paragraphWidth)}article li{margin-bottom:var(--halfLine);max-width:calc(var(--paragraphWidth) - var(--lineSpace))}.index-date{color:var(--grey);font-family:var(--monospace);font-size:var(--small);min-width:6rem;margin-right:var(--halfLine)}.index-item{margin-bottom:var(--halfLine)}.index-link{align-items:baseline;display:flex}.index-list{padding-left:0;list-style-type:none}.flag{background-color:var(--blue10);border-left:var(--quarterLine)solid var(--blue);margin-bottom:var(--lineSpace);padding:var(--halfLine)var(--quarterLine)}.flag :last-child{margin-bottom:0}.full-width{max-width:100%}.mute-links a{text-decoration:none;color:inherit}.no-border{border:0}.no-border img{border:0}.no-squish{overflow:auto}.no-squish img{max-width:none}@media screen and (min-width:40rem){.pull-left{float:left;clear:left;margin-right:var(--halfLine)}.pull-right{float:right;clear:right;margin-left:var(--halfLine)}.pull-left img,.pull-right img{display:block;margin-bottom:var(--lineSpace)}}</style><style>div.highlight>pre.chroma{padding:0;margin:0}:root{--lineNumberGrey: #6D6D6D;--operatorOrange: #B45000;--stringGreen: #357D06}.chroma .x{color:#000}.chroma .err{color:#a40000}.chroma .ln{margin-right:var(--halfLine);padding:0;color:var(--lineNumberGrey)}.chroma .k{color:#204a87;font-weight:700}.chroma .kc{color:#204a87;font-weight:700}.chroma .kd{color:#204a87;font-weight:700}.chroma .kn{color:#204a87;font-weight:700}.chroma .kp{color:#204a87;font-weight:700}.chroma .kr{color:#204a87;font-weight:700}.chroma .kt{color:#204a87;font-weight:700}.chroma .n{color:#000}.chroma .na{color:#c4a000}.chroma .nb{color:#204a87}.chroma .bp{color:#3465a4}.chroma .nc{color:#000}.chroma .no{color:#000}.chroma .nd{color:#5c35cc;font-weight:700}.chroma .ni{color:var(--operatorOrange)}.chroma .ne{color:#c00;font-weight:700}.chroma .nf{color:#000}.chroma .fm{color:#000}.chroma .nl{color:#f57900}.chroma .nn{color:#000}.chroma .nx{color:#000}.chroma .py{color:#000}.chroma .nt{color:#204a87;font-weight:700}.chroma .nv{color:#000}.chroma .vc{color:#000}.chroma .vg{color:#000}.chroma .vi{color:#000}.chroma .vm{color:#000}.chroma .l{color:#000}.chroma .ld{color:#000}.chroma .s{color:var(--stringGreen)}.chroma .sa{color:var(--stringGreen)}.chroma .sb{color:var(--stringGreen)}.chroma .sc{color:var(--stringGreen)}.chroma .dl{color:var(--stringGreen)}.chroma .sd{color:#8f5902;font-style:italic}.chroma .s2{color:var(--stringGreen)}.chroma .se{color:var(--stringGreen)}.chroma .sh{color:var(--stringGreen)}.chroma .si{color:var(--stringGreen)}.chroma .sx{color:var(--stringGreen)}.chroma .sr{color:var(--stringGreen)}.chroma .s1{color:var(--stringGreen)}.chroma .ss{color:var(--stringGreen)}.chroma .m{color:#0000cf;font-weight:700}.chroma .mb{color:#0000cf;font-weight:700}.chroma .mf{color:#0000cf;font-weight:700}.chroma .mh{color:#0000cf;font-weight:700}.chroma .mi{color:#0000cf;font-weight:700}.chroma .il{color:#0000cf;font-weight:700}.chroma .mo{color:#0000cf;font-weight:700}.chroma .o{color:var(--operatorOrange);font-weight:700}.chroma .ow{color:#204a87;font-weight:700}.chroma .p{color:#000;font-weight:700}.chroma .c{color:#8f5902;font-style:italic}.chroma .ch{color:#8f5902;font-style:italic}.chroma .cm{color:#8f5902;font-style:italic}.chroma .c1{color:#8f5902;font-style:italic}.chroma .cs{color:#8f5902;font-style:italic}.chroma .cp{color:#8f5902;font-style:italic}.chroma .cpf{color:#8f5902;font-style:italic}.chroma .g{color:#000}.chroma .gd{color:#a40000}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#ef2929}.chroma .gh{color:navy;font-weight:700}.chroma .gi{color:#00a000}.chroma .go{color:#000;font-style:italic}.chroma .gp{color:#8f5902}.chroma .gs{color:#000;font-weight:700}.chroma .gu{color:purple;font-weight:700}.chroma .gt{color:#a40000;font-weight:700}.chroma .gl{color:#000;text-decoration:underline}.chroma .w{color:#f8f8f8;text-decoration:underline}</style></head><body><div class=wrapper><header class=site-header><div class="site-title-container mute-links"><h1 class=site-title><a href=/>Primary Unit</a></h1><p class=site-byline><i>by</i> Rob Wells</p></div><nav id=site-nav><ul class="site-links mute-links"><li><a href=/about/>About</a></li><li><a href=/books/>Books I’ve read</a></li><li>Feed:
<a href=/feed.json>JSON</a>,
<a href=/rss.xml>RSS</a></li></ul></nav></header><main><article><header><h2 class=mute-links><a href=/2020/04/listing-shortlog-files-chronologically-with-launchbar/>Listing shortlog files chronologically with LaunchBar</a></h2><p><time datetime=2020-04-25T06:00:00+0100>Saturday, April 25 2020</time></p></header><p>Building on <a href=https://www.robjwells.com/2020/04/shortlogging/>my introductory post about maintaining “shortlog” diary files</a>, I quite often want to have a look at recent shortlog files.</p><p>I have my shortlog folder indexed by <a href=https://www.obdev.at/products/launchbar/index.html>LaunchBar</a>, so I can browse the files that way. By default these are listed in lexicographically ascending order. You can reverse this by holding down command when navigating into the folder in LaunchBar.</p><p>However, that doesn’t resolve the problem that it’s not always easy to realise that 2020-04-13 is “Monday”.</p><p>So I thought I would write a <a href=https://developer.obdev.at/launchbar-developer-documentation/#/actions-overview>LaunchBar action</a> to do both.</p><p>Despite being my first, it was really very easy. I wrote it in JavaScript as the documentation leads you that way, and you don’t have to serialise to JSON and write to stdout to return values. LaunchBar provides some additional tools to make interacting with the system straightforward from JavaScript. (And, to be clear, this isn’t <a href=https://developer.apple.com/library/archive/documentation/LanguagesUtilities/Conceptual/MacAutomationScriptingGuide/index.html>JXA</a> either.)</p><p>Here are the settings in the scripts pane in LaunchBar’s Action Editor:</p><figure class=full-width><a href=action-editor-script-settings.png><img src=action-editor-script-settings.png alt="A screenshot of the scripts pane settings in LaunchBar’s action editor for a default script, showing the default settings except that it returns an Item" width=510 height=250></a></figure><p>This is a default script, taking no input. One thing to note is that it returns a result of type “Item” — an array of JavaScript objects with particular keys. You can read about the properties items can have <a href=https://developer.obdev.at/launchbar-developer-documentation/#/actions-overview>in the LaunchBar action developer documentation</a>.</p><p>And here’s the code:</p><div class=highlight><pre class=chroma><code class=language-JavaScript data-lang=JavaScript><span class=ln> 1</span><span class=kd>function</span> <span class=nx>run</span><span class=p>(</span><span class=nx>argument</span><span class=p>)</span> <span class=p>{</span>
<span class=ln> 2</span>  <span class=kr>const</span> <span class=nx>shortlogDir</span> <span class=o>=</span> <span class=s2>&#34;~/Dropbox/notes/shortlog/&#34;</span>
<span class=ln> 3</span>  <span class=k>return</span> <span class=nx>File</span><span class=p>.</span><span class=nx>getDirectoryContents</span><span class=p>(</span>
<span class=ln> 4</span>    <span class=nx>shortlogDir</span>
<span class=ln> 5</span>  <span class=p>).</span><span class=nx>filter</span><span class=p>(</span><span class=nx>fileName</span> <span class=p>=&gt;</span>
<span class=ln> 6</span>    <span class=o>/^</span><span class=nx>shortlog</span><span class=o>-</span><span class=mi>20</span><span class=err>\</span><span class=nx>d</span><span class=p>{</span><span class=mi>2</span><span class=p>}</span><span class=o>-</span><span class=err>\</span><span class=nx>d</span><span class=p>{</span><span class=mi>2</span><span class=p>}</span><span class=o>-</span><span class=err>\</span><span class=nx>d</span><span class=p>{</span><span class=mi>2</span><span class=p>}.</span><span class=nx>txt$</span><span class=o>/</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>fileName</span><span class=p>)</span>
<span class=ln> 7</span>  <span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>fileName</span> <span class=p>=&gt;</span> <span class=p>{</span>
<span class=ln> 8</span>    <span class=kr>const</span> <span class=nx>isoString</span> <span class=o>=</span> <span class=nx>fileName</span><span class=p>.</span><span class=nx>substring</span><span class=p>(</span><span class=mi>9</span><span class=p>,</span> <span class=mi>19</span><span class=p>)</span>
<span class=ln> 9</span>    <span class=kr>const</span> <span class=nx>dateString</span> <span class=o>=</span> <span class=nx>LaunchBar</span><span class=p>.</span><span class=nx>formatDate</span><span class=p>(</span>
<span class=ln>10</span>      <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>isoString</span><span class=p>),</span>
<span class=ln>11</span>      <span class=p>{</span>
<span class=ln>12</span>        <span class=nx>timeStyle</span><span class=o>:</span> <span class=s2>&#34;none&#34;</span><span class=p>,</span>
<span class=ln>13</span>        <span class=nx>dateStyle</span><span class=o>:</span> <span class=s2>&#34;full&#34;</span><span class=p>,</span>
<span class=ln>14</span>        <span class=nx>relativeDateFormatting</span><span class=o>:</span> <span class=kc>true</span>
<span class=ln>15</span>      <span class=p>}</span>
<span class=ln>16</span>    <span class=p>)</span>
<span class=ln>17</span>    <span class=k>return</span> <span class=p>{</span>
<span class=ln>18</span>      <span class=nx>title</span><span class=o>:</span> <span class=nx>dateString</span><span class=p>,</span>
<span class=ln>19</span>      <span class=nx>path</span><span class=o>:</span> <span class=nx>shortlogDir</span> <span class=o>+</span> <span class=nx>fileName</span><span class=p>,</span>
<span class=ln>20</span>      <span class=cm>/* Use the ISO string as LaunchBar rejects returned objects
</span><span class=ln>21</span><span class=cm>         containing types other than strings, numbers, arrays
</span><span class=ln>22</span><span class=cm>         and objects (dictionaries) */</span>
<span class=ln>23</span>      <span class=nx>date</span><span class=o>:</span> <span class=nx>isoString</span>
<span class=ln>24</span>    <span class=p>}</span>
<span class=ln>25</span>  <span class=p>}).</span><span class=nx>sort</span><span class=p>(</span>
<span class=ln>26</span>    <span class=cm>/* Note this is a string comparison, but it’s OK as
</span><span class=ln>27</span><span class=cm>       we’re comparing ISO date strings. */</span>
<span class=ln>28</span>    <span class=p>(</span><span class=nx>first</span><span class=p>,</span> <span class=nx>second</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>first</span><span class=p>.</span><span class=nx>date</span> <span class=o>&gt;</span> <span class=nx>second</span><span class=p>.</span><span class=nx>date</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=o>:</span> <span class=mi>1</span>
<span class=ln>29</span>  <span class=p>)</span>
<span class=ln>30</span><span class=p>}</span>
</code></pre></div><p>This is just a “default script”, and while <code>run</code> takes an argument, it’s ignored.</p><p>We treat this as a simple pipeline of transformations on data:</p><ul><li>reading the contents of a directory (lines 3 & 4)</li><li>keeping only those whose filenames match dated shortlog files (lines 5 & 6)</li><li>creating an object containing a human-readable date, the path to the file, and an ISO-format date string (lines 7–24)</li><li>sorting those objects on the ISO date string, newest to oldest (lines 25–29).</li></ul><p>In line 3, we make use of the <code>File</code> object, which is provided by LaunchBar. And in lines 9–12 we use the <code>formatDate</code> function on the <code>LaunchBar</code> object, which gives us access to the system’s date formatting, which is both locale-aware and respects the user’s date & time preferences.</p><figure class=pull-right><a href=shortlogs-action-result.png><img src=shortlogs-action-result.png alt="A screenshot showing the resulting list of files in reverse date order in LaunchBar" width=310 height=459></a></figure><p>By providing the path in the result object, LaunchBar treats each entry in the list as a file, so you can press return to open it, or press the right arrow to inspect its details.</p><p>One oddity: I did try to store a JavaScript <code>Date</code> in the result objects, to use in the final sorting, but LaunchBar displays an error if a <code>Date</code> in the returned items. You could strip out any of your custom properties, but here I just use the ISO-format date string from the filename as it works just as well for the sorting comparison.</p><p>(Another oddity: I initially created the <code>Date</code> (now in line 10) manually with the date components extracted from the ISO-format date string. I learned that the constructor doesn’t take a <code>month</code> argument but instead a <code>monthIndex</code>, in the range 0–11. <a href=https://stackoverflow.com/questions/2552483/why-does-the-month-argument-range-from-0-to-11-in-javascripts-date-constructor>Some background on why this is</a>.)</p></article></main><footer class=site-footer><small class=mute-links>This work is licensed under a
<a rel=license href=https://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a>.</small></footer></div></body></html>