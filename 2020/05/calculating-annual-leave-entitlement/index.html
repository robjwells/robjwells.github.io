<!doctype html><html lang=en><head><title>Primary Unit – Calculating annual leave entitlement</title><meta charset=utf-8><meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; media-src 'self'; block-all-mixed-content; base-uri 'self'"><link rel=license href=https://creativecommons.org/licenses/by/4.0/><link rel=alternate type=application/rss+xml href=/rss.xml title="Primary Unit"><link rel=alternate type=application/json href=/feed.json title="Primary Unit"><link rel=mask-icon href=/favicon.svg color=#1369bf><link rel=apple-touch-icon-precomposed href=/favicon.png><link rel=icon href=/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A blog by Rob Wells, mostly about computer stuff."><style>html,body,div,span,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,address,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strong,sub,sup,var,b,u,i,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,menu,nav,output,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font:inherit;vertical-align:baseline}input,button{font-family:inherit}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section{display:block}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}table{border-collapse:collapse;border-spacing:0}html{box-sizing:border-box;text-size-adjust:100%}*,*:before,*:after{box-sizing:inherit}:root{--grey:#607080;--grey10:#eff0f2;--grey5:#f7f8f9;--blue:#1369bf;--blue10:#e7eff8;--purple:#7436b3;--lineSpace:1.75rem;--halfLine:calc(var(--lineSpace) / 2);--quarterLine:calc(var(--lineSpace) / 4);--bigGap:calc(var(--lineSpace) * 2);--paragraphWidth:40rem;--wrapperWidth:50rem;--huge:1.75rem;--big:1.5625rem;--medium:1.375rem;--text:1.125rem;--small:0.875rem;--codeInText:0.875em;--bodyFonts:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Oxygen", Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Helvetica, sans-serif;--monospace:'Source Code Pro', 'Consolas', 'Menlo', 'Monaco', monospace}body{background-color:var(--grey5);font-family:var(--bodyFonts);font-size:var(--text);font-style:normal;font-weight:400;line-height:1.55555;text-size-adjust:100%;-webkit-text-size-adjust:100%}.wrapper{margin:0 auto;max-width:var(--wrapperWidth);padding:var(--lineSpace)var(--halfLine)}h2,h3,h4{margin:0 0 var(--lineSpace)}h2{font-size:var(--huge)}h3{font-size:var(--big)}h4{font-size:var(--medium)}blockquote,figure,p,pre,table,caption,dl,ol,ul,div.highlight{margin-bottom:var(--lineSpace)}blockquote,pre,div.highlight{background-color:var(--grey10);padding:var(--halfLine)}blockquote{font-style:italic}blockquote em,blockquote i{font-style:normal}blockquote p:last-child{margin-bottom:0}figcaption{font-style:italic}hr{border:none;border-top:1px solid var(--grey);margin:var(--lineSpace)0}img,video{box-sizing:content-box;border:1px solid var(--grey);height:auto;max-width:100%}pre{overflow-x:auto}dl,ol,ul{margin-bottom:var(--lineSpace)}ol,ul{list-style-position:outside;padding-left:var(--lineSpace)}ol{list-style-type:decimal}ul{list-style-type:square}a:link{color:var(--blue);text-decoration:underline}a:visited{color:var(--purple)}a:focus,a:hover,a:active{background-color:var(--blue10)}strong,b{font-weight:700}em,i{font-style:italic}code{font-size:var(--codeInText)}.highlight,pre code,small{font-size:var(--small)}.highlight,code{font-family:var(--monospace)}small{color:var(--grey)}table{width:100%}.table-container{overflow-x:auto}caption{font-style:italic}thead{border-bottom:1px solid var(--grey)}tfoot{border-top:1px solid var(--grey)}th,td{width:auto;padding:var(--halfLine);overflow:auto;text-align:left}th{background-color:var(--grey10);font-weight:700}.table-figures{text-align:right;font-family:var(--monospace)}.site-header{border-left:var(--quarterLine)solid var(--blue);display:flex;flex-wrap:wrap;margin-bottom:var(--lineSpace);padding-left:var(--quarterLine)}.site-title-container{flex-shrink:0;margin-right:var(--lineSpace);max-width:100%}.site-title{font-size:var(--huge);line-height:var(--huge);margin-bottom:0}.site-byline{margin-bottom:0}.site-links{color:var(--grey);list-style-type:none;margin-bottom:0;padding:0}.site-footer{margin-top:var(--bigGap)}article{border-bottom:1px solid var(--grey);margin-bottom:var(--bigGap)}article:last-of-type{border-bottom:none}article header{margin-bottom:var(--lineSpace)}article header h2{margin-bottom:0}article header time{color:var(--grey)}article li{margin-bottom:var(--halfLine)}.index-date{color:var(--grey);font-family:var(--monospace);font-size:var(--small);min-width:6rem;margin-right:var(--halfLine)}.index-item{margin-bottom:var(--halfLine)}.index-link{align-items:baseline;display:flex}.index-list{padding-left:0;list-style-type:none}.flag{background-color:var(--blue10);border-left:var(--quarterLine)solid var(--blue);margin-bottom:var(--lineSpace);padding:var(--halfLine)var(--quarterLine)}.flag :last-child{margin-bottom:0}.full-width{max-width:100%}.mute-links a{text-decoration:none;color:inherit}.no-border{border:0}.no-border img{border:0}.no-squish{overflow:auto}.no-squish img{max-width:none}@media screen and (min-width:40rem){.pull-left{float:left;clear:left;margin-right:var(--halfLine)}.pull-right{float:right;clear:right;margin-left:var(--halfLine)}.pull-left img,.pull-right img{display:block;margin-bottom:var(--lineSpace)}}</style><style>div.highlight>pre.chroma{padding:0;margin:0}:root{--lineNumberGrey:#6D6D6D;--operatorOrange:#B45000;--stringGreen:#357D06}.chroma .x{color:#000}.chroma .err{color:#a40000}.chroma .ln{margin-right:var(--halfLine);padding:0;color:var(--lineNumberGrey)}.chroma .k{color:#204a87;font-weight:700}.chroma .kc{color:#204a87;font-weight:700}.chroma .kd{color:#204a87;font-weight:700}.chroma .kn{color:#204a87;font-weight:700}.chroma .kp{color:#204a87;font-weight:700}.chroma .kr{color:#204a87;font-weight:700}.chroma .kt{color:#204a87;font-weight:700}.chroma .n{color:#000}.chroma .na{color:#c4a000}.chroma .nb{color:#204a87}.chroma .bp{color:#3465a4}.chroma .nc{color:#000}.chroma .no{color:#000}.chroma .nd{color:#5c35cc;font-weight:700}.chroma .ni{color:var(--operatorOrange)}.chroma .ne{color:#c00;font-weight:700}.chroma .nf{color:#000}.chroma .fm{color:#000}.chroma .nl{color:#f57900}.chroma .nn{color:#000}.chroma .nx{color:#000}.chroma .py{color:#000}.chroma .nt{color:#204a87;font-weight:700}.chroma .nv{color:#000}.chroma .vc{color:#000}.chroma .vg{color:#000}.chroma .vi{color:#000}.chroma .vm{color:#000}.chroma .l{color:#000}.chroma .ld{color:#000}.chroma .s{color:var(--stringGreen)}.chroma .sa{color:var(--stringGreen)}.chroma .sb{color:var(--stringGreen)}.chroma .sc{color:var(--stringGreen)}.chroma .dl{color:var(--stringGreen)}.chroma .sd{color:#8f5902;font-style:italic}.chroma .s2{color:var(--stringGreen)}.chroma .se{color:var(--stringGreen)}.chroma .sh{color:var(--stringGreen)}.chroma .si{color:var(--stringGreen)}.chroma .sx{color:var(--stringGreen)}.chroma .sr{color:var(--stringGreen)}.chroma .s1{color:var(--stringGreen)}.chroma .ss{color:var(--stringGreen)}.chroma .m{color:#0000cf;font-weight:700}.chroma .mb{color:#0000cf;font-weight:700}.chroma .mf{color:#0000cf;font-weight:700}.chroma .mh{color:#0000cf;font-weight:700}.chroma .mi{color:#0000cf;font-weight:700}.chroma .il{color:#0000cf;font-weight:700}.chroma .mo{color:#0000cf;font-weight:700}.chroma .o{color:var(--operatorOrange);font-weight:700}.chroma .ow{color:#204a87;font-weight:700}.chroma .p{color:#000;font-weight:700}.chroma .c{color:#8f5902;font-style:italic}.chroma .ch{color:#8f5902;font-style:italic}.chroma .cm{color:#8f5902;font-style:italic}.chroma .c1{color:#8f5902;font-style:italic}.chroma .cs{color:#8f5902;font-style:italic}.chroma .cp{color:#8f5902;font-style:italic}.chroma .cpf{color:#8f5902;font-style:italic}.chroma .g{color:#000}.chroma .gd{color:#a40000}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#ef2929}.chroma .gh{color:navy;font-weight:700}.chroma .gi{color:#00a000}.chroma .go{color:#000;font-style:italic}.chroma .gp{color:#8f5902}.chroma .gs{color:#000;font-weight:700}.chroma .gu{color:purple;font-weight:700}.chroma .gt{color:#a40000;font-weight:700}.chroma .gl{color:#000;text-decoration:underline}.chroma .w{color:#f8f8f8;text-decoration:none}</style></head><body><div class=wrapper><header class=site-header><div class="site-title-container mute-links"><h1 class=site-title><a href=/>Primary Unit</a></h1><p class=site-byline><i>by</i> Rob Wells</p></div><nav id=site-nav><ul class="site-links mute-links"><li><a href=/about/>About</a></li><li><a href=/books/>Books I’ve read</a></li><li>Feed:
<a href=/feed.json>JSON</a>,
<a href=/rss.xml>RSS</a></li></ul></nav></header><main><article><header><h2 class=mute-links><a href=/2020/05/calculating-annual-leave-entitlement/>Calculating annual leave entitlement</a></h2><p><time datetime=2020-05-23T18:00:00+0100>Saturday, May 23 2020</time></p></header><p>In my current job, and for much of my last job, I induct new employees and make some of the arrangements for leaving employees.
Part of that is working out how much annual leave they’re entitled to.
Unfortunately people tend not to start exactly at the beginning of the leave year and leave exactly at the end of the leave year.</p><p>Many years ago I wrote a simple Python script to do this for me — it asks for the start and end dates, and prints out how much annual leave the person would accrue over that period.</p><p>You can <a href=https://annualleavecalculator-end-date.robjwells.repl.run/>run the calculator in your browser at Repl.it</a>.
(It has an odd name in the URL because originally the script only handled new starts, not leavers, and I don’t want to break the URL for my old colleagues who use it.)</p><p>I’ve cleaned it up today after seeing that <a href=https://repl.it/talk/announcements/Feedback-for-git-support-the-new-GitHub-integration/21631>Repl.it can publish new repos to GitHub</a> (though that feature has some <a href=https://repl.it/talk/announcements/1-to-this-feature-thanks-but-I-came/21631/175353>rough edges</a>).</p><p>You can <a href=https://github.com/robjwells/annual_leave_calculator/blob/master/main.py>find the code on GitHub</a>.
Mostly it’s uninteresting, the first 40 lines being the module docstring and the last 30 being mostly wrappers around <code>input()</code>, so here’s the meat of it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=c1># Modify these constants to suit your circumstances</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=n>DEFAULT_AL_YEAR_START</span> <span class=o>=</span> <span class=n>date</span><span class=o>.</span><span class=n>today</span><span class=p>()</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>month</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>day</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=n>DEFAULT_AL</span> <span class=o>=</span> <span class=mi>28</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=n>RESULT_DECIMAL_PLACES</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=n>al_for_full_year</span> <span class=o>=</span> <span class=n>prompt_for_al_amount</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=n>al_year_start</span> <span class=o>=</span> <span class=n>prompt_for_date</span><span class=p>(</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>        <span class=s2>&#34;Leave year start&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>        <span class=n>default</span><span class=o>=</span><span class=n>DEFAULT_AL_YEAR_START</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=n>al_year_end</span> <span class=o>=</span> <span class=n>al_year_start</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>        <span class=n>year</span><span class=o>=</span><span class=n>al_year_start</span><span class=o>.</span><span class=n>year</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=p>)</span> <span class=o>-</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=n>start_date</span> <span class=o>=</span> <span class=n>prompt_for_date</span><span class=p>(</span><span class=s2>&#34;Employee start&#34;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=n>al_year_start</span><span class=p>)</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=n>end_date</span> <span class=o>=</span> <span class=n>prompt_for_date</span><span class=p>(</span><span class=s2>&#34;Employee finish&#34;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=n>al_year_end</span><span class=p>)</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>
</span></span><span class=line><span class=ln>21</span><span class=cl>    <span class=n>al_year_days</span> <span class=o>=</span> <span class=p>(</span><span class=n>al_year_end</span> <span class=o>-</span> <span class=n>al_year_start</span><span class=p>)</span><span class=o>.</span><span class=n>days</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=n>employed_days</span> <span class=o>=</span> <span class=p>(</span><span class=n>end_date</span> <span class=o>-</span> <span class=n>start_date</span><span class=p>)</span><span class=o>.</span><span class=n>days</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>    <span class=c1># +1 as we assume, eg, starting and leaving on Jan 1 accrues</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=c1># 1 day&#39;s worth of leave, not zero</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>
</span></span><span class=line><span class=ln>26</span><span class=cl>    <span class=n>proportion_of_al_year_worked</span> <span class=o>=</span> <span class=n>employed_days</span> <span class=o>/</span> <span class=n>al_year_days</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>    <span class=n>al_days_available</span> <span class=o>=</span> <span class=n>al_for_full_year</span> <span class=o>*</span> <span class=n>proportion_of_al_year_worked</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>    <span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>        <span class=nb>round</span><span class=p>(</span><span class=n>al_days_available</span><span class=p>,</span> <span class=n>RESULT_DECIMAL_PLACES</span><span class=p>),</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>        <span class=s2>&#34;days annual leave&#34;</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>    <span class=p>)</span>
</span></span></code></pre></div><p>One thing to state up front is that this only considers leave accrual within a single annual leave year.
Crossing a leave-year boundary isn’t as simple as adding additional leave, as it’ll typically involve some limit on how much leave can be carried across (which may be zero).</p><p>There’s also little error-handling, so if you enter something that parses but is nonsensical (negative amount of leave, an end date earlier than the start date) then the result will be nonsensical.</p><p>Until I refactored the script today, I’d made assumptions about the leave year that meant you’d have to edit the script more than a little to use leave years that don’t match the calendar year.
I changed that today by prompting the user for the start of the leave year (defaulting to January 1) and calculating the leave year end with some basic date manipulation in lines 14-16.
(This was to fix a regression I introduced, not the result of any great foresight!)</p><p>This manipulation isn’t completely robust, but if you say your leave year starts on February 29 then that’s your responsibility.</p><p>Lines 21 & 22 are noteworthy for the <code>+ 1</code>, so that you get an inclusive range of days, with the assumption being that the person works on the “start day” and also on the “finish day”.
There’s some redundancy between lines 16 and 21, calculating the leave year by subtracting a day and adding it back later, but that’s to fit my mental model that the leave year runs eg from January 1 to December 31, and not January 1 to January 1.</p><p>The rest of the script just works out the proportion of the leave year worked against the length of the full leave year, and computes the same proportion of the total number of leave days available for the full year.</p><p>Nothing really tricky, but I work in a small company so it’s easy to misremember the process when you only do it a couple of times a year.</p><p>Here’s an example session:</p><pre tabindex=0><code>How many days annual leave for the full year? [28] 30
Leave year start date [2020-01-01]: 2020-04-01
Employee start date [2020-04-01]:
Employee finish date [2021-03-31]: 2020-06-05
5.42 days annual leave
</code></pre><p>It’s a bit awkward to put in a “start date” for employees who have been employed since before the start of the leave year, and similar for employees who (you hope!) will continue past the end of the leave year, but the prompting helpers take a default value which you can accept by pressing return.</p><p>There’s no need to review the prompting helper functions but I will take a moment to appreciate the signature of the typed wrapper around <code>input()</code>.
It is generic over some type <code>T</code>, takes a function <code>str → T</code>, and a default <code>T</code>, which is returned if the user input is empty.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>T</span> <span class=o>=</span> <span class=n>TypeVar</span><span class=p>(</span><span class=s2>&#34;T&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>_prompt_wrapper</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[[</span><span class=nb>str</span><span class=p>],</span> <span class=n>T</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span><span class=p>:</span> <span class=n>T</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>T</span><span class=p>:</span> <span class=o>...</span>
</span></span></code></pre></div><p>A more general version would probably take a <code>T?</code> as the default and perhaps have <code>T?</code> as the return type also if parsing fails.
But in this case all callers supply a default and, as far as the callers are concerned, parsing never fails because the user is prompted repeatedly until they enter something that does parse (or they accept the default).</p></article></main><footer class=site-footer><small class=mute-links>This work is licensed under a
<a rel=license href=https://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a>.</small></footer></div></body></html>